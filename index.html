<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Cut Contract</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f1a31; --border:#203050;
      --text:#ffffff; --muted:#a8b3cf;
      --btn:#2563eb; --ahead:#22c55e; --behind:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text);padding:15px;padding-bottom:50px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:15px;margin-bottom:12px}
    .big{font-size:32px;font-weight:950;font-variant-numeric:tabular-nums;letter-spacing:-1px}
    .label{font-size:11px;color:var(--muted);text-transform:uppercase;font-weight:800;letter-spacing:1px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .status-good{color:var(--ahead)}
    .status-bad{color:var(--behind)}
    input{width:100%;background:#0b1220;border:1px solid #2a3a60;border-radius:10px;padding:12px;color:white;margin:10px 0;font-size:16px}
    .btn{background:var(--btn);border:none;color:white;padding:14px;border-radius:12px;font-weight:800;width:100%;cursor:pointer}
    .btn:active{transform:scale(0.98)}
    .item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #1f2a44}
    .check-row{display:flex;align-items:center;gap:10px;margin:8px 0;font-weight:700;font-size:14px}
    input[type="checkbox"]{width:22px;height:22px;margin:0}
    .save-indicator{font-size:10px;color:var(--ahead);float:right;margin-top:4px}
  </style>
</head>
<body>

  <div class="card">
    <span class="save-indicator" id="saveHint">● SYNCED</span>
    <div class="label">Daily Mission</div>
    <div class="check-row"><input type="checkbox"> 12-3-30 Treadmill</div>
    <div class="check-row"><input type="checkbox"> 10,000 Steps</div>
    <div class="check-row"><input type="checkbox"> 1,600 Cals (Chicken/Rice/Eggs)</div>
  </div>

  <div class="card">
    <div class="label">Live Burn (TDEE 2800)</div>
    <div class="big" id="liveBurn">0.000</div>
    <div class="label" id="deficitDisp" style="margin-top:5px;color:var(--ahead)">Current Deficit: 0 kcal</div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="label">Contract</div>
      <div class="big" id="pct">0.00%</div>
    </div>
    <div class="card">
      <div class="label">Target Lbs</div>
      <div class="big" id="targetNow">0.00</div>
    </div>
  </div>

  <div class="card">
    <div class="label">Weight Status</div>
    <div id="status" class="big" style="font-size:26px;margin:5px 0">LOG WEIGHT</div>
    <input id="weighInput" type="number" step="0.1" inputmode="decimal" placeholder="Enter lbs">
    <button class="btn" id="addWeigh">Add Weigh-In</button>
  </div>

  <div class="card">
    <div class="label">Log History</div>
    <div id="list" style="margin-top:10px"></div>
    <button class="btn" style="background:transparent;color:var(--behind);font-size:12px;margin-top:20px" id="wipe">Wipe All Data</button>
  </div>

<script>
  const STORAGE_KEY = "CUT_CONTRACT_OFFICIAL_v1";

  // 1. Initial State
  let state = {
    startAt: new Date("2026-02-08T00:00:00").getTime(),
    endAt: new Date("2026-05-01T00:00:00").getTime(),
    startWeight: 216,
    goalLoss: 30,
    dailyIntake: 1600,
    tdee: 2800,
    weighIns: []
  };

  // 2. Load Function (The "Forever" Memory)
  function loadState() {
    const data = localStorage.getItem(STORAGE_KEY);
    if (data) {
      const parsed = JSON.parse(data);
      state = { ...state, ...parsed }; 
    }
  }

  // 3. Save Function
  function saveState() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    const hint = document.getElementById('saveHint');
    hint.innerText = "● SAVED";
    setTimeout(() => { hint.innerText = "● SYNCED"; }, 2000);
  }

  function render() {
    const now = new Date();
    const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate()).getTime();
    
    // Live Burn Math
    const msSinceMidnight = now.getTime() - startOfDay;
    const burnedSoFar = msSinceMidnight * (state.tdee / 86400000);
    document.getElementById('liveBurn').innerText = burnedSoFar.toFixed(3);
    
    const intakeSoFar = (state.dailyIntake / 86400000) * msSinceMidnight;
    document.getElementById('deficitDisp').innerText = "Current Deficit: " + Math.floor(burnedSoFar - intakeSoFar) + " kcal";

    // Contract Progress Math
    const totalContractTime = state.endAt - state.startAt;
    const elapsed = now.getTime() - state.startAt;
    const progress = Math.max(0, Math.min(1, elapsed / totalContractTime));
    
    document.getElementById('pct').innerText = (progress * 100).toFixed(2) + "%";
    
    const currentTarget = state.startWeight - (state.goalLoss * progress);
    document.getElementById('targetNow').innerText = currentTarget.toFixed(2);

    // Pace Logic
    const statusEl = document.getElementById('status');
    if (state.weighIns.length > 0) {
      const latest = state.weighIns[state.weighIns.length - 1].w;
      const diff = currentTarget - latest;
      if (diff >= 0) {
        statusEl.innerText = "AHEAD +" + diff.toFixed(2);
        statusEl.className = "big status-good";
      } else {
        statusEl.innerText = "BEHIND " + Math.abs(diff).toFixed(2);
        statusEl.className = "big status-bad";
      }
    }

    // List Rendering
    document.getElementById('list').innerHTML = state.weighIns.slice().reverse().slice(0,7).map(i => `
      <div class="item">
        <span style="font-weight:bold">${i.w} lbs</span>
        <span class="label">${new Date(i.t).toLocaleDateString()}</span>
      </div>
    `).join('');
  }

  // Input Handler
  document.getElementById('addWeigh').onclick = () => {
    const val = parseFloat(document.getElementById('weighInput').value);
    if (val) {
      state.weighIns.push({ t: Date.now(), w: val });
      saveState();
      document.getElementById('weighInput').value = '';
      render();
    }
  };

  // Wipe Handler
  document.getElementById('wipe').onclick = () => {
    if (confirm("Clear all weigh-ins and reset?")) {
      localStorage.removeItem(STORAGE_KEY);
      location.reload();
    }
  };

  // Run
  loadState();
  setInterval(render, 100);
  render();
</script>
</body>
</html>
